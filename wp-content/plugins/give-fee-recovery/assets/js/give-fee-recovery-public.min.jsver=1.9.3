var give_global_vars,Give_Fee_Recovery;jQuery.noConflict(),function(e){Give_Fee_Recovery={init:function(){e(".give-form-wrap").each(function(){var a=e(this).find(".give-form"),i=a.find(".give-fee-disable").val(),n=!!parseInt(i),t=a.find("input.give-gateway:radio:checked").val(),o=a.find('input[name="give-amount"]').val();e(this).find(".give-fee-message").hide(),n&&e(this).find(".give-fee-message").show(),"undefined"==typeof t&&(t=a.attr("data-gateway")),n&&Give_Fee_Recovery.give_fee_update(a,!0,o,t)})},give_fee_update:function(a,i,n,t){var o=a.find(".give-final-total-amount"),f=a.find(".give-fee-message-label-text"),r=a.find(".fee-break-down-message"),v=r.data("breakdowntext"),d=a.find(".give_fee_mode_checkbox").val(),_=Give.form.fn.getInfo("decimal_separator",a),u=give_fee_unformat_amount(n,_),g=JSON.parse(a.find('input[name="give-fee-recovery-settings"]').val());if(a.has(".give_fee_mode_checkbox").length>=1&&0!==d&&"undefined"!==d&&(i=a.find(".give_fee_mode_checkbox").is(":checked")),0===a.find(".give-fee-message").length)return!1;o.show(),r.hide();var m=g.fee_recovery,s=g.fee_data.all_gateways,c=0,l=0,p=!0,y=!0,h=!1,w=!1,b=0;if(m){s?(c=g.fee_data.all_gateways.base_amount,l=g.fee_data.all_gateways.percentage,p=g.fee_data.all_gateways.is_break_down,y=g.fee_data.all_gateways.give_fee_status,h=g.fee_data.all_gateways.give_fee_disable,w=g.fee_data.all_gateways.maxAmount):jQuery.each(g.fee_data,function(e,a){t===e&&(c=a.base_amount,l=a.percentage,p=a.is_break_down,y=a.give_fee_status,h=a.give_fee_disable,w=a.maxAmount)});var G=give_fee_recovery_object.give_fee_zero_based_currency,k=JSON.parse(G),x=Give.form.fn.getInfo("currency_code",a),F=Give.form.fn.getInfo("number_decimals",a);1>=parseInt(F)&&-1===jQuery.inArray(x,k)&&(F=2),b=give_fee_calculate(l,c,give_fee_unformat_amount(n,_),h),-1!==jQuery.inArray(x,k)&&(F=0,b=Math.ceil(b)),w=parseFloat(w),w>0&&(b=Math.min(b,w)),i&&(u+=give_fee_unformat_amount(Give.fn.formatCurrency(b,{precision:F},a)));var R=v.replace("{amount}",give_fee_format_amount(give_fee_unformat_amount(n,_),a)),j=R.replace("{fee_amount}",give_fee_format_amount(b,a));if(h)a.find(".give-fee-recovery-donors-choice").hide(),a.find(".fee-coverage-required").hide();else{var A=!1,C=a[0].querySelector('input[name="give-form-id"]').value,I="#give-form-"+C+"-wrap",q=Array.from(document.querySelectorAll(I)).filter(function(e){return!e.querySelector("form.give-form")}).pop();q&&(A=q.classList.contains("give-display-modal")),A?a.parent().hasClass("mfp-content")||a.find(".give-fee-recovery-donors-choice").show():a.find(".give-fee-recovery-donors-choice").show(),a.find(".fee-coverage-required").show()}y?(a.find('input[name="give-fee-status"]').remove(),a.prepend('<input type="hidden" name="give-fee-status" value="enabled"/>')):(a.find('input[name="give-fee-status"]').remove(),a.prepend('<input type="hidden" name="give-fee-status" value="disabled"/>')),i&&p&&"undefined"!=typeof v&&(r.show(),a.find('input[name="give-payment-mode"]').remove(),a.prepend('<input type="hidden" name="give-payment-mode" value="'+t+'"/>'),r.text(j));var Q=a.find(".give-fee-message-label").data("feemessage"),S=Q.replace("{fee_amount}",give_fee_format_amount(b,a));f.text(S);var F;F="undefined"!=typeof give_global_vars?give_global_vars.number_decimals:give_vars.currency_decimals,1>=parseInt(F)&&(F=2),setTimeout(function(){o.text(give_fee_format_amount(u,a)).attr("data-total",Give.fn.formatCurrency(u,{precision:F},a))},0),0===give_fee_unformat_amount(Give.fn.formatCurrency(b,{precision:F},a))?(r.hide(),f.hide(),e(".give-fee-message-label").hide()):(f.show(),e(".give-fee-message-label").show()),a.find('input[name="give-fee-mode-enable"]').remove(),a.prepend('<input type="hidden" name="give-fee-mode-enable" value="'+i+'"/>'),a.find('input[name="give-fee-amount"]').remove(),a.prepend('<input type="hidden" name="give-fee-amount" value="'+give_fee_unformat_amount(Give.fn.formatCurrency(b,{precision:F},a))+'"/>')}else a.find('input[name="give-fee-status"]').remove(),a.prepend('<input type="hidden" name="give-fee-status" value="disabled"/>')}},e(function(){var a=e("body");a.on("change",".give_fee_mode_checkbox",function(){var a=e(this).closest("form.give-form"),i=e(this).is(":checked"),n=a.find("input.give-gateway:radio:checked").val(),t=a.find('input[name="give-amount"]').val();"undefined"==typeof n&&(n=a.attr("data-gateway")),Give_Fee_Recovery.give_fee_update(a,i,t,n)}).change(),e(document).on("give_donation_value_updated",function(a,i,n){i||(i=e(this).closest("form.give-form"));var t=i.find("input.give-gateway:radio:checked").val(),o="undefined"==typeof n?i.find('input[name="give-amount"]').val():n;"undefined"==typeof t&&(t=form.attr("data-gateway")),Give_Fee_Recovery.give_fee_update(i,!0,o,t)}),e(document).on("give_recurring_donation_amount_updated",function(a,i,n){i||(i=e(this).closest("form.give-form"));var t=i.attr("data-gateway");Give_Fee_Recovery.give_fee_update(i,!0,n,t)}),e(document).on("give_gateway_loaded",function(a,i,n){var t=e(a.currentTarget.activeElement).closest("form.give-form");0===t.length&&(t=e("#"+n));var o=t.find('li.give-gateway-option-selected input[name="payment-mode"]').val(),f=t.find('input[name="give-amount"]').val();"undefined"==typeof o&&(o=t.attr("data-gateway")),Give_Fee_Recovery.give_fee_update(t,!0,f,o)}),Give_Fee_Recovery.init()})}(jQuery);